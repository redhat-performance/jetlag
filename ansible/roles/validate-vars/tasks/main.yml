---
# validate-vars tasks

- name: Validate lab
  fail:
    msg: "Invalid lab selected('{{ lab }}') Select from {{ labs | list }} "
  when: lab not in labs

- name: Validate cluster_type
  fail:
    msg: "Invalid cluster_type selected - {{ cluster_type }}"
  when: cluster_type not in cluster_types

- name: Check pull secret var is set
  fail:
    msg: "Pull secret appears unset"
  when: pull_secret is not defined

- name: Check for RHEL 8.4 (Bastion Validation)
  fail:
    msg: "Upgrade to RHEL 8.4 for podman ipv6 support"
  when:
  - ansible_distribution is defined
  - (ansible_distribution != "RedHat" or ansible_distribution_version|float < 8.4)

- name: Set worker_node_count if undefined or empty (bm/rwn)
  set_fact:
    worker_node_count: "{{ allocation_node_count - 4 }}"
  when: (cluster_type == "bm" or cluster_type == "rwn") and
        (worker_node_count is undefined or not worker_node_count | int)

- name: Set sno_node_count if undefined or empty
  set_fact:
    sno_node_count: "{{ (allocation_node_count - 1) | int   }}"
  when: (cluster_type == "sno")  and
        (sno_node_count is undefined or not sno_node_count | int)

- name: Check if the required number of nodes exist for bm/rwn
  fail:
    msg: "Insufficient number of nodes in your allocation for bm/rwn"
  when: (allocation_node_count is defined and (cluster_type == "bm" or cluster_type == "rwn")) and (worker_node_count | int  > allocation_node_count - 4)

- name: Check if the required number of nodes exist for sno
  fail:
    msg: "Insufficient number of nodes in your allocation for bm/rwn"
  when: (allocation_node_count is defined and cluster_type == "sno") and (sno_node_count | int   > allocation_node_count | int  - 1)


